<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fechamento de Caixa</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: #f6fbff;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        color: #222;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 24px;
        max-width: 650px;
        width: 100%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
      }
      h1 {
        color: #0b63d4;
        font-size: 22px;
        text-align: center;
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 6px;
        color: #333;
        font-weight: 500;
        font-size: 14px;
      }
      input {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 14px;
        box-sizing: border-box;
      }
      button {
        margin-top: 10px;
        padding: 10px 12px;
        border: none;
        border-radius: 6px;
        color: #fff;
        cursor: pointer;
        font-size: 13px;
        transition: 0.2s;
      }
      button:hover {
        opacity: 0.9;
      }
      .add {
        background: #28a745;
        width: 48%;
      }
      .sub {
        background: #dc3545;
        width: 48%;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }
      .compact-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 10px;
      }
      .divider {
        width: 100%;
        height: 1px;
        background: #e2e2e2;
        margin: 20px 0;
      }
      .btns {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
      }
      .totais {
        background: #eef6ff;
        padding: 12px;
        border-radius: 8px;
        margin-top: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      td {
        padding: 6px 0;
        font-size: 14px;
      }
      td:first-child {
        text-align: left;
        color: #555;
      }
      td:last-child {
        text-align: right;
        font-weight: 600;
        color: #222;
      }
      .erro {
        color: #d32f2f;
        font-size: 13px;
        margin-top: 6px;
        display: none;
      }
      #baixarPDF,
      #fecharTurno {
        background: #0b63d4;
        width: 100%;
        margin-top: 16px;
        padding: 12px;
        font-size: 14px;
        border-radius: 6px;
      }
      #fecharTurno {
        background: #111;
      }

      /* Responsivo para mobile */
      @media (max-width: 768px) {
        .row,
        .compact-row {
          grid-template-columns: 1fr;
          gap: 15px;
        }
        .btns button {
          width: 48%;
          font-size: 12px;
        }
        h1 {
          font-size: 20px;
        }
        .totais {
          padding: 10px;
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 12px;
        }
        .card {
          padding: 16px;
        }
        h1 {
          font-size: 18px;
        }
        .totais {
          padding: 8px;
          font-size: 13px;
        }
        input {
          padding: 8px;
          font-size: 13px;
        }
        .btns button {
          font-size: 11px;
          padding: 8px 10px;
        }
      }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
  </head>
  <body>
    <div class="card">
      <h1>Fechamento de Caixa</h1>

      <div class="compact-row">
        <div>
          <label>Frentista</label>
          <input id="frentista" type="text" placeholder="Nome do frentista" />
          <div id="erroFrentista" class="erro">
            ⚠️ O nome do frentista é obrigatório
          </div>
        </div>
        <div>
          <label>Data</label>
          <input id="dataRegistro" type="date" />
        </div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <div>
          <label>Dinheiro (R$)</label>
          <input id="dinheiro" type="number" step="0.01" placeholder="0.00" />
          <div class="btns">
            <button class="add" onclick="adicionarValor('dinheiro')">+</button>
            <button class="sub" onclick="subtrairValor('dinheiro')">–</button>
          </div>
        </div>
        <div>
          <label>Cartão (R$)</label>
          <input id="cartao" type="number" step="0.01" placeholder="0.00" />
          <div class="btns">
            <button class="add" onclick="adicionarValor('cartao')">+</button>
            <button class="sub" onclick="subtrairValor('cartao')">–</button>
          </div>
        </div>
        <div>
          <label>Vale (R$)</label>
          <input id="vale" type="number" step="0.01" placeholder="0.00" />
          <div class="btns">
            <button class="add" onclick="adicionarValor('vale')">+</button>
            <button class="sub" onclick="subtrairValor('vale')">–</button>
          </div>
        </div>
        <div>
          <label>Pix (R$)</label>
          <input id="pix" type="number" step="0.01" placeholder="0.00" />
          <div class="btns">
            <button class="add" onclick="adicionarValor('pix')">+</button>
            <button class="sub" onclick="subtrairValor('pix')">–</button>
          </div>
        </div>
      </div>

      <div class="totais" id="resumo"></div>

      <button id="baixarPDF">Baixar PDF</button>
      <button id="fecharTurno">Fechar Turno (Zerar)</button>
    </div>

    <script>
      const dataEl = document.getElementById("dataRegistro");
      const hoje = new Date().toISOString().slice(0, 10);
      dataEl.value = hoje;

      const valores = { dinheiro: 0, cartao: 0, vale: 0, pix: 0 };
      const fmtBR = (v) =>
        new Intl.NumberFormat("pt-BR", {
          style: "currency",
          currency: "BRL",
        }).format(v);

      function atualizarResumo() {
        const total =
          valores.dinheiro + valores.cartao + valores.vale + valores.pix;
        const html = `
        <table>
          <tr><td>Dinheiro:</td><td>${fmtBR(valores.dinheiro)}</td></tr>
          <tr><td>Cartão:</td><td>${fmtBR(valores.cartao)}</td></tr>
          <tr><td>Vale:</td><td>${fmtBR(valores.vale)}</td></tr>
          <tr><td>Pix:</td><td>${fmtBR(valores.pix)}</td></tr>
          <tr><td>Total:</td><td style="color:#2e7d32;">${fmtBR(
            total
          )}</td></tr>
        </table>`;
        document.getElementById("resumo").innerHTML = html;
      }

      function adicionarValor(tipo) {
        const campo = document.getElementById(tipo);
        const val = parseFloat(campo.value) || 0;
        valores[tipo] += val;
        campo.value = "";
        atualizarResumo();
      }

      function subtrairValor(tipo) {
        const campo = document.getElementById(tipo);
        const val = parseFloat(campo.value) || 0;
        valores[tipo] = Math.max(0, valores[tipo] - val);
        campo.value = "";
        atualizarResumo();
      }

      function formatarData(data) {
        if (!data) return "-";
        const [ano, mes, dia] = data.split("-");
        return `${dia}/${mes}/${ano}`;
      }

      const frInput = document.getElementById("frentista");
      const erro = document.getElementById("erroFrentista");
      frInput.addEventListener("focus", () => (erro.style.display = "none"));
      frInput.addEventListener("input", () => (erro.style.display = "none"));

      document.getElementById("baixarPDF").addEventListener("click", gerarPDF);

      function gerarPDF() {
        const fr = frInput.value.trim();
        if (!fr) {
          erro.style.display = "block";
          return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: "pt", format: "a4" });
        const total =
          valores.dinheiro + valores.cartao + valores.vale + valores.pix;
        const dataFormatada = formatarData(dataEl.value);

        // Cabeçalho cinza claro
        doc.setFillColor(220, 220, 220);
        doc.rect(40, 40, 515, 30, "F");
        doc.setTextColor(0, 0, 0);
        doc.setFont("helvetica", "bold");
        doc.setFontSize(16);
        doc.text(
          `Fechamento de Caixa - ${dataFormatada}`,
          doc.internal.pageSize.getWidth() / 2,
          60,
          { align: "center" }
        );

        // Tabela centralizada com bordas suaves
        const linhas = [
          ["FRENTISTA", fr],
          ["DINHEIRO", fmtBR(valores.dinheiro)],
          ["CARTÃO", fmtBR(valores.cartao)],
          ["VALE", fmtBR(valores.vale)],
          ["PIX", fmtBR(valores.pix)],
          ["TOTAL", fmtBR(total)],
        ];

        doc.autoTable({
          startY: 90,
          body: linhas,
          theme: "grid",
          styles: {
            halign: "center",
            fontSize: 12,
            cellPadding: 10,
            fillColor: [255, 255, 255],
            textColor: 0,
          },
          headStyles: {
            fillColor: [240, 240, 240],
            halign: "center",
            fontStyle: "bold",
          },
          columnStyles: {
            0: { cellWidth: 230, fontStyle: "bold" },
            1: { cellWidth: 230 },
          },
          margin: { left: (doc.internal.pageSize.getWidth() - 460) / 2 },
        });

        doc.save(`fechamento_${dataFormatada.replace(/\//g, "-")}.pdf`);
      }

      document.getElementById("fecharTurno").addEventListener("click", () => {
        const fr = frInput.value.trim();
        if (!fr) {
          erro.style.display = "block";
          return;
        }
        for (let k in valores) valores[k] = 0;
        atualizarResumo();
        alert("Turno fechado e valores zerados.");
      });

      atualizarResumo();
    </script>
  </body>
</html>
